:root{
  --bg:#f4f6fb;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
  --line:#e5e7eb;
  --accent:#635bff;

  --radius: 16px;
  --radius2: 18px;
  --shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
  --shadow2: 0 8px 22px rgba(15, 23, 42, 0.08);

  --gap: 16px;
}

*{ box-sizing:border-box; }
html, body{ height:100%; }
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background:var(--bg);
  color:var(--text);
}

a{ color:inherit; text-decoration:none; }
button, input, select{
  font-family: inherit;
}

/* ===== Header ===== */
.topbar{
  position:sticky;
  top:0;
  z-index:5;
  background:rgba(244,246,251,0.9);
  backdrop-filter: blur(10px);
  border-bottom:1px solid var(--line);
}
.topbar-inner{
  max-width: 1480px;
  margin:0 auto;
  padding:14px 16px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
.brand{
  display:flex;
  flex-direction:column;
  gap:2px;
}
.brand .t{
  font-size:14px;
  font-weight:900;
}
.brand .sub{
  font-size:12px;
  color:var(--muted);
  font-weight:700;
}
.status{
  font-size:12px;
  color:var(--muted);
  font-weight:900;
}

/* ===== Layout ===== */
.page{
  max-width: 1480px;
  margin:0 auto;
  padding:16px;
}

/* ===== Cards / Panels ===== */
.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius: var(--radius2);
  box-shadow: var(--shadow2);
}

/* ===== Metrics Bar ===== */
.metrics-bar{
  border-radius: var(--radius2);
  border:1px solid var(--line);
  background: #ffffff;
  box-shadow: var(--shadow2);
  overflow:hidden;
}
.metrics-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:12px 14px;
  border-bottom:1px solid var(--line);
}
.metrics-head .left{
  display:flex;
  align-items:center;
  gap:10px;
}
.metrics-head .t{
  font-size:13px;
  font-weight:1000;
}
.metrics-head .btns{
  display:flex;
  gap:8px;
}
.btn{
  border:1px solid var(--line);
  background:#fff;
  padding:8px 10px;
  border-radius: 12px;
  font-weight:1000;
  font-size:12px;
  cursor:pointer;
}
.btn.primary{
  background:var(--accent);
  color:#fff;
  border-color: transparent;
}
.btn.danger{
  background:#ef4444;
  color:#fff;
  border-color: transparent;
}

.metrics-body{
  padding:14px;
}
.metrics-row{
  display:grid;
  grid-template-columns: repeat(5, minmax(0, 1fr));
  gap:12px;
}
.metrics-zone{
  border:1px solid var(--line);
  border-radius: 16px;
  padding:10px 10px 12px;
  background:#fbfdff;
}
.metrics-zone .zone-title{
  font-size:12px;
  font-weight:1000;
  color:var(--muted);
  margin-bottom:8px;
}
.metrics-zone .zone-area{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  min-height: 42px;
  align-content:flex-start;
}
.metric-chip{
  border:1px solid var(--line);
  background:#fff;
  padding:7px 10px;
  border-radius: 999px;
  font-size:12px;
  font-weight:1000;
  cursor:grab;
  user-select:none;
  max-width: 100%;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.metrics-tools{
  margin-top: 12px;
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:14px;
}
.sort-box{
  flex:1;
  border:1px solid var(--line);
  border-radius:16px;
  padding:12px;
  background:#fff;
}
.sort-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom:10px;
}
.sort-head .t{
  font-size:12px;
  font-weight:1000;
  color:var(--muted);
}
.sort-rows{
  display:flex;
  flex-direction:column;
  gap:8px;
}
.sort-row{
  display:grid;
  grid-template-columns: 1fr 140px 70px;
  gap:8px;
}
.sort-row select{
  width:100%;
  border:1px solid var(--line);
  border-radius: 12px;
  padding:9px 10px;
  font-weight:1000;
  font-size:12px;
}
.sort-row button{
  border:1px solid var(--line);
  border-radius:12px;
  background:#fff;
  font-weight:1000;
  font-size:12px;
  cursor:pointer;
}

.metrics-actions{
  display:flex;
  flex-direction:column;
  gap:8px;
  min-width: 220px;
}
.metrics-actions .btn{
  width:100%;
}

/* collapse */
.metrics-bar.collapsed .metrics-body{
  display:none;
}

/* ===== Main grid ===== */
.main-grid{
  display:grid;
  grid-template-columns: 260px 1fr 330px;
  gap: var(--gap);
  margin-top: 16px;
}

.side{
  padding:12px;
}
.side .t{
  font-size:12px;
  font-weight:1000;
  color:var(--muted);
  margin-bottom:10px;
}
.asin-list{
  display:flex;
  flex-direction:column;
  gap:8px;
  max-height: calc(100vh - 260px);
  overflow:auto;
  padding-right:4px;
}
.asin-btn{
  border:1px solid var(--line);
  border-radius: 12px;
  background:#fff;
  padding:10px 12px;
  font-weight:1000;
  font-size:12px;
  cursor:pointer;
  text-align:left;
}
.asin-btn:hover{
  border-color:#cbd5e1;
}

.center{
  min-width:0;
}
.items{
  display:flex;
  flex-direction:column;
  gap:14px;
}
.empty{
  padding:20px;
  text-align:center;
  color:var(--muted);
  font-weight:900;
  font-size:13px;
}

/* ===== Product card (default) ===== */
.product-card{
  padding:14px;
}
.card-top{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom: 12px;
}
.card-top .title{
  font-size:13px;
  font-weight:1000;
}
.card-top .remove{
  border:1px solid var(--line);
  background:#fff;
  border-radius: 12px;
  padding:8px 10px;
  font-weight:1000;
  font-size:12px;
  cursor:pointer;
}

.summary-row{
  display:grid;
  grid-template-columns: 520px 1fr;
  gap: 14px;
  align-items:start;
}

.left-wrap{
  display:flex;
  gap:14px;
  align-items:stretch;
}
.image-box{
  width: 260px;
  border-radius: var(--radius2);
  border:1px solid var(--line);
  background:#fff;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.image-box img{
  width:100%;
  height: 220px;
  object-fit:cover;
  display:block;
  background:#f8fafc;
}
.image-box .field{
  padding: 0 12px 12px;
}
.image-box label{
  display:block;
  font-size:11px;
  font-weight:1000;
  color:var(--muted);
  margin-top:8px;
  margin-bottom:6px;
}
.image-box select,
.image-box input{
  width:100%;
  border:1px solid var(--line);
  border-radius: 12px;
  padding:9px 10px;
  font-weight:1000;
  font-size:12px;
}
.cart-btn{
  margin-top:10px;
  width:100%;
  border:none;
  border-radius: 14px;
  height:44px;
  background: var(--accent);
  color:#fff;
  font-weight:1000;
  font-size:13px;
  cursor:pointer;
}

.info-box{
  border-radius: var(--radius2);
  border:1px solid var(--line);
  background:#fff;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  min-width:0;
}
.info-head{
  padding:10px 12px;
  border-bottom:1px solid var(--line);
  background:#fbfdff;
}
.info-head .t{
  font-size:12px;
  font-weight:1000;
  color:var(--muted);
}
.info-grid{
  display:grid;
  grid-template-columns: 130px 1fr;
  gap:10px 12px;
  padding:12px;
}
.info-grid .k{
  font-size:12px;
  font-weight:1000;
  color:var(--muted);
  white-space:nowrap;
}
.info-grid .v{
  font-size:12px;
  font-weight:1000;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.tag{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:4px 10px;
  border-radius: 999px;
  font-weight:1000;
  font-size:11px;
  border:1px solid var(--line);
  background:#fff;
  margin-right:6px;
}
.tag.red{ background:#fee2e2; border-color:#fecaca; color:#b91c1c; }
.tag.blue{ background:#dbeafe; border-color:#bfdbfe; color:#1d4ed8; }
.tag.yellow{ background:#fef9c3; border-color:#fde68a; color:#92400e; }

.graph-box{
  border-radius: var(--radius2);
  border:1px solid var(--line);
  background:#fff;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  min-width:0;
}
.graph-head{
  padding:10px 12px;
  border-bottom:1px solid var(--line);
  background:#fbfdff;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.graph-title{
  font-size:12px;
  font-weight:1000;
  color:var(--muted);
}
.graph-options{
  padding:10px 12px;
  display:flex;
  gap:14px;
  border-bottom:1px solid var(--line);
  background:#fff;
}
.graph-options label{
  font-size:12px;
  font-weight:1000;
  color:var(--text);
  display:flex;
  align-items:center;
  gap:6px;
}
.graph-body{
  padding:12px;
}
.canvas-wrap{
  border-radius: 14px;
  overflow:hidden;
  background:#eef2ff;
  border:1px solid #dbeafe;
  height: 260px;
}
.canvas-wrap canvas{
  width:100%;
  height:100%;
}
.keepa-wrap{
  border-radius: 14px;
  overflow:hidden;
  border:1px solid var(--line);
  background:#fff;
  height: 260px;
  margin-top: 12px;
}
.keepa-wrap iframe{
  width:100%;
  height:100%;
  border:0;
}

/* ===== Right cart summary ===== */
#cartSummary{
  position:sticky;
  top: 84px;
  padding:12px;
}
.cart-title{
  font-size:12px;
  font-weight:1000;
  color:var(--muted);
  margin-bottom:10px;
}
.cart-grid{
  display:grid;
  grid-template-columns: 1fr;
  gap:10px;
}
.cart-item{
  border:1px solid var(--line);
  border-radius: 14px;
  background:#fff;
  padding:10px 12px;
}
.cart-item .k{
  font-size:11px;
  font-weight:1000;
  color:var(--muted);
}
.cart-item .v{
  font-size:14px;
  font-weight:1000;
  margin-top:4px;
}

/* ===== Detail table ===== */
.detail-wrap{
  margin-top: 12px;
  border:1px solid var(--line);
  border-radius: var(--radius2);
  overflow:hidden;
  background:#fff;
}
.detail-head{
  padding:10px 12px;
  border-bottom:1px solid var(--line);
  background:#fbfdff;
}
.detail-head .t{
  font-size:12px;
  font-weight:1000;
}
.detail-scroll{
  overflow:auto;
}
.detail-table{
  width:100%;
  border-collapse:collapse;
  min-width: 780px;
}
.detail-table th, .detail-table td{
  border-bottom:1px solid var(--line);
  padding:12px 14px;
  text-align:left;
  font-size:12px;
  font-weight:1000;
  white-space:nowrap;
}
.detail-table th{
  color:var(--muted);
  background:#fff;
  position:sticky;
  top:0;
  z-index:1;
}
.detail-table tbody tr:nth-child(odd) td{ background:#fcfcff; }
.detail-table tbody tr:last-child td{border-bottom:none}

.info-td{ min-width: 220px; }
.info-td-scroll{
  white-space:nowrap;
  overflow-x:auto;
  overflow-y:hidden;
  -webkit-overflow-scrolling: touch;
}
.info-td-tags{ white-space:normal; }

/* responsive */
@media (max-width: 1200px){
  .metrics-row{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
}
@media (max-width: 1100px){
  .main-grid{ grid-template-columns: 1fr; }
  #cartSummary{ position:relative; top:0; }
  .summary-row{ grid-template-columns: 1fr; }
  #cartSummary{ top: 64px; }
  .cart-grid{ grid-template-columns: 1fr 1fr; }
}
@media (max-width: 680px){
  .metrics-row{ grid-template-columns: 1fr; }
  .left-wrap{ flex-direction:column; }
  .image-box{ width:100%; }
}

/* =========================
   Alt layout (2nd page)
   - 画像＋商品情報を1枠に統合（alt-media）
   - 4カラムの上段を「同じ高さ」で揃える
   - 全体の高さを短めに（スクロールで内容確認）
========================= */
body.alt-layout{
  --altRowH: 420px;          /* 上段の高さ（短めにしたい時はここを調整） */
  --altImgH: 150px;          /* 画像の高さ */
  --altGraphPartH: 190px;    /* keepa / 需要供給 それぞれの高さ */
}

body.alt-layout .alt-grid{
  display:grid;
  grid-template-columns: 360px 360px 1fr 300px;
  gap:14px;
  align-items:stretch;
  grid-template-rows: var(--altRowH);
}

/* それぞれ同じ高さに */
body.alt-layout .alt-left,
body.alt-layout .alt-center,
body.alt-layout .alt-graph,
body.alt-layout .alt-buy{
  height: var(--altRowH);
  min-height: 0;
}

/* 画像＋商品情報（1枠） */
body.alt-layout .alt-media{
  border:1px solid var(--line);
  border-radius:var(--radius2);
  background:#fff;
  padding:12px 14px;
  display:flex;
  flex-direction:column;
  gap:10px;
  min-width:0;
}

body.alt-layout .alt-media-img img{
  width:100%;
  height:var(--altImgH);
  object-fit:cover;
  border-radius:var(--radius2);
  border:1px solid var(--line);
  background:#f8fafc;
  display:block;
}

/* 商品情報は残り領域をスクロール */
body.alt-layout .alt-media-info{
  flex:1;
  min-height:0;
  overflow:auto;
  padding-right:4px;
}

/* 主要項目も高さ固定でスクロール */
body.alt-layout .alt-center{
  display:flex;
  flex-direction:column;
  min-height:0;
}
body.alt-layout .alt-center .center-head{ flex:0 0 auto; }
body.alt-layout .alt-center .center-list{
  flex:1;
  min-height:0;
  overflow:auto;
  padding-right:4px;
}

/* カートも高さ固定で、ボタンは下に固定 */
body.alt-layout .buy-box{
  border:1px solid var(--line);
  border-radius:var(--radius2);
  background:#fff;
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:10px;
  height:100%;
  min-height:0;
}
body.alt-layout .buy-title{
  font-size:12px;
  font-weight:900;
  color:var(--muted);
}
body.alt-layout .buy-box input,
body.alt-layout .buy-box select{
  width:100%;
  border:1px solid var(--line);
  border-radius:12px;
  padding:10px 10px;
  font-weight:900;
  font-size:13px;
}
body.alt-layout .buy-box .cart-btn{
  margin-top:auto;
  height:46px;
}

/* グラフ：2段（短め） */
body.alt-layout .graph-box{
  height:100%;
  min-height:0;
  display:flex;
  flex-direction:column;
}
body.alt-layout .graph-body{
  flex:1;
  min-height:0;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  gap:12px;
}
body.alt-layout .canvas-wrap,
body.alt-layout .keepa-wrap{
  height:var(--altGraphPartH);
  border-radius:var(--radius2);
  overflow:hidden;
  background:#fff;
  border:1px solid var(--line);
}
body.alt-layout .canvas-wrap{
  background:#eef2ff;
  border:1px solid #dbeafe;
}
body.alt-layout .keepa-wrap iframe{
  width:100%;
  height:100%;
  border:0;
}

/* モバイル：縦積み（高さ固定を解除して自然な高さへ） */
@media (max-width: 1100px){
  body.alt-layout{
    --altRowH: auto;
  }
  body.alt-layout .alt-grid{
    grid-template-columns: 1fr;
    grid-template-rows: auto;
  }
  body.alt-layout .alt-left,
  body.alt-layout .alt-center,
  body.alt-layout .alt-graph,
  body.alt-layout .alt-buy{
    height:auto;
  }
  body.alt-layout .alt-media-info,
  body.alt-layout .alt-center .center-list{
    max-height: 260px;
  }
}

/* =========================
   Layout3 (3rd page)
   - 画像2の配置イメージ
   - 商品情報①/②に分割
   - keepa小 + 需要供給グラフ大
========================= */
body.third-layout .layout3-grid{
  display:grid;
  grid-template-columns: 340px 320px 320px 360px 260px;
  /* ✅ 追加：上段（赤枠）の高さを揃える */
  grid-template-rows: 320px auto;
  gap:14px;
  align-items:stretch;
}

body.third-layout .l3-image{
  grid-column:1;
  grid-row:1;
}
body.third-layout .l3-infoA{
  grid-column:2;
  grid-row:1;
}
body.third-layout .l3-infoB{
  grid-column:3;
  grid-row:1;
}
body.third-layout .l3-center{
  grid-column:4;
  grid-row:1;
}
body.third-layout .l3-buy{
  grid-column:5;
  grid-row:1 / span 2;
}

body.third-layout .l3-keepa{
  grid-column:1;
  grid-row:2;
}
body.third-layout .l3-mes{
  grid-column:2 / span 3;
  grid-row:2;
}

body.third-layout .l3-block{
  border:1px solid var(--line);
  border-radius:var(--radius2);
  background:#fff;
  padding:12px 14px;
  min-width:0;
  /* ✅ 追加：中身を高さ揃え + スクロール可能にするため */
  display:flex;
  flex-direction:column;
  height:100%;
  min-height:0;
}

body.third-layout .l3-block .head{
  font-size:12px;
  font-weight:1000;
  margin-bottom:10px;
}

/* ✅ 追加：上段ブロック内のコンテンツは必要に応じてスクロール */
body.third-layout .l3-block .info-grid,
body.third-layout .l3-block .center-list{
  flex:1;
  min-height:0;
  overflow:auto;
  padding-right:4px;
}

body.third-layout .l3-image .image-box{
  width:100%;
  gap:0;
}
body.third-layout .l3-image .image-box img{
  width:100%;
  height:100%;
  object-fit:cover;
  border-radius:var(--radius2);
  border:1px solid var(--line);
  background:#f8fafc;
  display:block;
}

body.third-layout .l3-buy{
  border:2px solid #111827;
  border-radius:var(--radius2);
  padding:12px;
  background:#fff;
}
body.third-layout .l3-buy .buy-title{
  font-size:12px;
  font-weight:1000;
  color:var(--muted);
}
body.third-layout .l3-buy input,
body.third-layout .l3-buy select{
  width:100%;
  border:1px solid var(--line);
  border-radius:12px;
  padding:10px 10px;
  font-weight:1000;
  font-size:13px;
}
body.third-layout .l3-buy .cart-btn{
  height:46px;
}

body.third-layout .l3-keepa{
  background:#f3f4f6;
}
body.third-layout .l3-keepa .keepa-mini{
  height:180px;
  border-radius:14px;
  overflow:hidden;
  border:1px solid var(--line);
  background:#fff;
}
body.third-layout .l3-keepa iframe{
  width:100%;
  height:100%;
  border:0;
}

body.third-layout .l3-mes .mes-big{
  height:260px;
  border-radius:14px;
  overflow:hidden;
  border:1px solid #dbeafe;
  background:#eef2ff;
}
body.third-layout .l3-mes canvas{
  width:100%;
  height:100%;
}

@media (max-width: 1400px){
  body.third-layout .layout3-grid{
    grid-template-columns: 1fr 1fr;
  }
  body.third-layout .l3-buy{ grid-column:1 / -1; grid-row:auto; }
  body.third-layout .l3-mes{ grid-column:1 / -1; }
  body.third-layout .l3-center{ grid-column:1 / -1; }
  body.third-layout .l3-infoA{ grid-column:1; }
  body.third-layout .l3-infoB{ grid-column:2; }
  body.third-layout .l3-image{ grid-column:1 / -1; }
  body.third-layout .l3-keepa{ grid-column:1 / -1; }
}
